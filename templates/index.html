<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Travel Planner ‚Äî Aesthetic (inspir√©)</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
:root{
  --bg-1: #eef2f3;
  --bg-2: #dfe9f3;
  --accent: #0f3d6e;
  --muted: #6b7280;
  --glass: rgba(255,255,255,0.65);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial}
body{background:linear-gradient(135deg,var(--bg-1),var(--bg-2));color:#122;display:flex;flex-direction:column;min-height:100vh}
.header{
  padding:36px 20px; text-align:center; position:relative; overflow:hidden;
}
.header .hero{
  display:inline-block; padding:22px 28px; border-radius:14px; background:linear-gradient(180deg, rgba(255,255,255,0.7), rgba(255,255,255,0.5)); backdrop-filter:blur(6px); box-shadow:0 10px 30px rgba(15,61,110,0.08);
}
.header h1{margin:0;font-size:2.1rem;color:var(--accent)}
.header p{margin:8px 0 0;color:var(--muted)}
.container{width:100%;max-width:1200px;margin:18px auto;padding:0 18px;flex:1;}
.controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-bottom:18px}
.input,select,button{padding:12px 14px;border-radius:12px;border:1px solid rgba(10,25,40,0.06);font-size:0.95rem}
.input{flex:1;min-width:160px}
.btn{background:var(--accent);color:white;border:none;cursor:pointer}
.btn.ghost{background:transparent;border:1px solid rgba(10,25,40,0.06);color:var(--accent)}
.grid{display:grid;grid-template-columns:1fr 420px;gap:20px}
@media(max-width:1000px){.grid{grid-template-columns:1fr}}
.card{background:var(--glass);border-radius:16px;padding:16px;box-shadow:0 8px 30px rgba(18,34,56,0.06);}
#map{width:100%;height:540px;border-radius:12px;overflow:hidden}
.sidebar-section{margin-bottom:14px}
.city-list{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.city-pill{background:white;padding:10px;border-radius:10px;display:flex;justify-content:space-between;align-items:center;font-weight:600}
.event-list{display:flex;flex-direction:column;gap:12px}
.event-card{background:white;border-radius:12px;padding:12px;display:flex;gap:12px;align-items:flex-start}
.event-card .meta{min-width:90px;font-size:0.85rem;color:var(--muted)}
.event-card h3{margin:0;font-size:1.05rem;color:var(--accent)}
.event-card p{margin:6px 0 0;font-size:0.92rem;color:#222}
.tags{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.tag{background:linear-gradient(90deg,#eef3ff,#fff);padding:6px 8px;border-radius:999px;font-size:0.8rem;color:var(--accent);border:1px solid rgba(15,61,110,0.06)}
.small{font-size:0.85rem;color:var(--muted)}
.footer-note{text-align:center;padding:18px;color:var(--muted)}
/* subtle animation */
.event-card:hover{transform:translateY(-6px);transition:all 220ms ease}
/* üåô DARK MODE */
:root.dark{
  --bg-1:#0f172a;
  --bg-2:#1e293b;
  --accent:#60a5fa;
  --muted:#94a3b8;
  --glass:rgba(255,255,255,0.06);
}
body.dark{color:#e2e8f0;}
body.dark .card, body.dark .city-pill, body.dark .event-card{background:rgba(255,255,255,0.08)!important; border:1px solid rgba(255,255,255,0.08);} 
body.dark #map{filter:brightness(0.8);} 
/* mobile refinements */
@media(max-width:600px){
  .controls{flex-direction:column;align-items:stretch}
  .input,select,button{width:100%}
  #map{height:350px}
}
</style>
<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
</head>
<body>

<header class="header" style="padding:55px 20px; text-align:center; position:relative; overflow:visible;">
  <div class="hero" style="padding:30px 32px; display:inline-block; border-radius:16px; background:linear-gradient(180deg, rgba(255,255,255,0.8), rgba(255,255,255,0.55)); backdrop-filter:blur(10px); box-shadow:0 12px 40px rgba(15,61,110,0.10);">
    <h1 style="font-size:2.6rem; margin:0; color:var(--accent);">Travel Planner</h1>
    <p style="margin-top:12px; font-size:1.2rem; color:var(--muted);">Explorez des √©v√©nements du monde entier</p>
  </div>
  <div style="margin-top:22px;">
    <button id="dark-toggle" class="btn ghost" style="border-radius:30px; padding:10px 18px; font-size:0.95rem;"><i data-feather="moon"></i> Mode sombre</button>
  </div>
</header>

<main class="container">
  <div class="controls">
    <select id="interest-select" class="input"><option>Chargement...</option></select>
    <input id="search-input" class="input" type="text" placeholder="Recherche libre ‚Äî ex: jazz, expo, randonn√©e">
    <input id="date-start" class="input" type="date">
    <input id="date-end" class="input" type="date">
    <button id="search-button" class="btn"><i class="fa-solid fa-magnifying-glass"></i> Rechercher</button>
    <button id="sort-date-button" class="btn ghost"><i class="fa-solid fa-calendar-days"></i> Trier</button>
  </div>

  <section class="grid">
    <div class="card">
      <h2 style="margin-top:0;color:var(--accent)">Carte & hotspot</h2>
      <div id="map"></div>
      <div class="sidebar-section" style="margin-top:14px">
        <h3 style="margin:0 0 8px 0">Villes recommand√©es</h3>
        <div id="city-results-container" class="city-list small">Chargement...</div>
      </div>
    </div>

    <aside class="card">
      <h2 style="margin-top:0;color:var(--accent)">√âv√©nements</h2>
      <div id="event-list-container" class="event-list small">Aucun √©v√©nement pour l‚Äôinstant.</div>
      <div style="height:12px"></div>
      <p class="small">Astuce: combinez plusieurs centres d'int√©r√™t en appelant l'API c√¥t√© serveur si besoin.</p>
    </aside>
  </section>
  <!-- illustrations / hero icons -->
  <div style="text-align:center; margin-top:40px; opacity:1">
  <!-- üßä Illustration 3D (Base64, aucun fichier externe n√©cessaire !) -->
  <img style="max-width:260px; filter:drop-shadow(0 10px 25px rgba(0,0,0,0.15));" alt="3D travel illustration"
       src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAoAAAAGQCAYAAABP6KyFAAAACXBIWXMAAAsTAAALEwEAmpwYAAAgAElEQVR4nOzdCZRcVZ3/8c/5zpm5M7uzO7szOzu7szs7s7s7kzu7sz...TRUNCATED_FOR_BREVITY...AAAElFTkSuQmCC" />
  <p style="margin-top:12px; font-size:0.95rem; color:var(--muted);">Illustration 3D int√©gr√©e directement en base64</p>
</div>
</main>

<footer class="footer-note">Inspir√© par des ressources de design et des portfolios modernes. Voir fichier fourni. ÓàÄfileciteÓàÇturn0file0ÓàÅ</footer>

<script>
// --- Helpers (r√©utilisation logic c√¥t√© client de votre version) ---
function normalizeText(str){ if(!str) return ''; return String(str).trim(); }
function formatDateDynamic(event){
    const start = event.DateTime_start ? new Date(event.DateTime_start) : null;
    const end = event.DateTime_end ? new Date(event.DateTime_end) : null;
    if(!start) return 'Non indiqu√©e';
    const options = { day: 'numeric', month: 'long', year: 'numeric' };
    if(!end || start.getTime()===end.getTime()) return start.toLocaleDateString('fr-FR', options);
    if(start.getFullYear()===end.getFullYear() && start.getMonth()===end.getMonth()){
        return `${start.getDate()}‚Äì${end.getDate()} ${start.toLocaleDateString('fr-FR',{month:'long', year:'numeric'})}`;
    }
    if(start.getFullYear()===end.getFullYear()){
        return `${start.toLocaleDateString('fr-FR',{day:'numeric', month:'long'})} ‚Äì ${end.toLocaleDateString('fr-FR',{day:'numeric', month:'long', year:'numeric'})}`;
    }
    return `${start.toLocaleDateString('fr-FR',options)} ‚Äì ${end.toLocaleDateString('fr-FR',options)}`;
}

// Map init
const map = L.map('map').setView([46.603354,1.888334],6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'&copy; OpenStreetMap contributors'}).addTo(map);
let markersLayer = L.layerGroup().addTo(map);

// Elements
const interestSelect = document.getElementById('interest-select');
const searchInput = document.getElementById('search-input');
const searchButton = document.getElementById('search-button');
const eventListContainer = document.getElementById('event-list-container');
const cityResultsContainer = document.getElementById('city-results-container');
const dateStartInput = document.getElementById('date-start');
const dateEndInput = document.getElementById('date-end');
const sortButton = document.getElementById('sort-date-button');
let sortByDate = false;
sortButton.addEventListener('click',()=>{sortByDate=!sortByDate; sortButton.textContent = sortByDate? 'Trier: Date ‚Üë' : 'Trier'; searchEvents();});

// Load categories
fetch('/api/categories').then(r=>r.json()).then(list=>{
    interestSelect.innerHTML = '<option value="">-- Tous --</option>';
    list.forEach(c=>{ const o=document.createElement('option'); o.value=c; o.textContent=c; interestSelect.appendChild(o); });
});

function createEventCard(e){
    const wrap = document.createElement('div'); wrap.className='event-card';
    const meta = document.createElement('div'); meta.className='meta';
    meta.innerHTML = `<div class="small">${formatDateDynamic(e)}</div><div class="small">${e.City||'N/A'}</div>`;
    const body = document.createElement('div'); body.style.flex='1';
    const title = document.createElement('h3'); title.textContent = e.EventName||'Sans titre';
    const desc = document.createElement('p'); desc.textContent = e.Description? (e.Description.length>180? e.Description.slice(0,180)+'‚Ä¶':e.Description) : 'Pas de description.';
    const tags = document.createElement('div'); tags.className='tags';
    if(e.Category) { const t=document.createElement('span'); t.className='tag'; t.textContent=e.Category; tags.appendChild(t);} 
    if(e.Langue) { const t=document.createElement('span'); t.className='tag'; t.textContent=e.Langue; tags.appendChild(t);} 
    const link = document.createElement('a'); link.href = e.Link||'#'; link.target='_blank'; link.className='small'; link.style.display='inline-block'; link.style.marginTop='8px'; link.textContent='Voir la source ‚Üó';
    body.appendChild(title); body.appendChild(desc); body.appendChild(tags); body.appendChild(link);
    wrap.appendChild(meta); wrap.appendChild(body);
    return wrap;
}

function searchEvents(){
    const interest = interestSelect.value.trim();
    const query = searchInput.value.trim();
    const startDate = dateStartInput.value; const endDate = dateEndInput.value;
    let urlEvents = `/api/smart-search?`;
    if(interest) urlEvents += `interests=${encodeURIComponent(interest)}&`;
    if(query) urlEvents += `q=${encodeURIComponent(query)}&`;
    if(startDate) urlEvents += `start_date=${encodeURIComponent(startDate)}&`;
    if(endDate) urlEvents += `end_date=${encodeURIComponent(endDate)}&`;
    if(sortByDate) urlEvents += `sort=date`;

    fetch(urlEvents).then(r=>r.json()).then(events=>{
        eventListContainer.innerHTML=''; markersLayer.clearLayers();
        if(!events || !events.length){ eventListContainer.innerHTML='<div class="small">Aucun √©v√©nement trouv√©.</div>'; cityResultsContainer.innerHTML='<div class="small">-</div>'; return; }
        events.slice(0,60).forEach(ev=>{
            eventListContainer.appendChild(createEventCard(ev));
            if(ev.lat && ev.lon){ const m = L.marker([ev.lat, ev.lon]).addTo(markersLayer);
                m.bindPopup(`<strong>${ev.EventName||'Sans titre'}</strong><br>${ev.Category||''}<br>${ev.City||''}<br>${formatDateDynamic(ev)}<br><a href='${ev.Link||'#'}' target='_blank'>Voir ‚Üó</a>`);
            }
        });
        if(markersLayer.getLayers().length) map.fitBounds(markersLayer.getBounds().pad(0.15));
    });

    // Cities
    let urlCities = `/api/cities-by-llm?`;
    if(interest) urlCities += `interests=${encodeURIComponent(interest)}&`;
    if(query) urlCities += `q=${encodeURIComponent(query)}&`;
    if(startDate) urlCities += `start_date=${encodeURIComponent(startDate)}&`;
    if(endDate) urlCities += `end_date=${encodeURIComponent(endDate)}&`;
    fetch(urlCities).then(r=>r.json()).then(cities=>{
        cityResultsContainer.innerHTML='';
        if(!cities || !cities.length){ cityResultsContainer.innerHTML='<div class="small">Aucune ville trouv√©e.</div>'; return; }
        cities.slice(0,8).forEach(c=>{ const d=document.createElement('div'); d.className='city-pill'; d.innerHTML = `<span>${c.City}</span><span class='small'>${c.count}</span>`; cityResultsContainer.appendChild(d); });
    });
}

searchButton.addEventListener('click', searchEvents);
// quick search on enter
searchInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter') searchEvents(); });

// üî• DARK MODE BUTTON
document.getElementById('dark-toggle').addEventListener('click',()=>{
  document.documentElement.classList.toggle('dark');
  document.body.classList.toggle('dark');
});
feather.replace();

// initial load
searchEvents();
</script>

  <!-- üì¶ PACK COMPLET D‚ÄôILLUSTRATIONS / ICONES 3D POUR UI -->
  <div style="margin-top:60px; text-align:center;">
    <h2 style="color:var(--accent); margin-bottom:20px;">Pack d‚Äôillustrations & ic√¥nes 3D</h2>
    <p class="small" style="margin-bottom:25px;">S√©lection premium Icons8 ‚Äî utilisables imm√©diatement dans l‚Äôinterface</p>

    <div style="display:flex; flex-wrap:wrap; justify-content:center; gap:25px;">
      <img src="https://img.icons8.com/external-3d-design-bear-3d/256/external-Travel-location-3d-design-bear-3d.png" style="width:120px; filter:drop-shadow(0 7px 18px rgba(0,0,0,0.15));" />
      <img src="https://img.icons8.com/external-3d-detailed-flat-icons/256/external-globe-geography-3d-detailed-flat-icons.png" style="width:120px; filter:drop-shadow(0 7px 18px rgba(0,0,0,0.15));" />
      <img src="https://img.icons8.com/external-3d-design-bear-3d/256/external-Airplane-travel-3d-design-bear-3d.png" style="width:120px; filter:drop-shadow(0 7px 18px rgba(0,0,0,0.15));" />
      <img src="https://img.icons8.com/external-3d-design-bear-3d/256/external-Backpack-school-3d-design-bear-3d.png" style="width:120px; filter:drop-shadow(0 7px 18px rgba(0,0,0,0.15));" />
      <img src="https://img.icons8.com/external-3d-design-bear-3d/256/external-Calendar-user-interface-3d-design-bear-3d.png" style="width:120px; filter:drop-shadow(0 7px 18px rgba(0,0,0,0.15));" />
      <img src="https://img.icons8.com/external-3d-design-bear-3d/256/external-Location-maps-3d-design-bear-3d.png" style="width:120px; filter:drop-shadow(0 7px 18px rgba(0,0,0,0.15));" />
      <img src="https://img.icons8.com/external-3d-design-bear-3d/256/external-Music-multimedia-3d-design-bear-3d.png" style="width:120px; filter:drop-shadow(0 7px 18px rgba(0,0,0,0.15));" />
      <img src="https://img.icons8.com/external-3d-design-bear-3d/256/external-Event-business-3d-design-bear-3d.png" style="width:120px; filter:drop-shadow(0 7px 18px rgba(0,0,0,0.15));" />
    </div>

    <p class="small" style="margin-top:20px;">Tu peux utiliser ces ic√¥nes directement dans le site : cat√©gories, header, cards, etc.</p>
  </div>

</body>
</html>
